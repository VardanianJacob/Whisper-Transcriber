<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Audio Transcription Debug</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f0f0f0;
      color: #333;
    }

    .container {
      background: white;
      padding: 20px;
      border-radius: 8px;
      max-width: 600px;
      margin: 0 auto;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .btn {
      padding: 15px 30px;
      margin: 10px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      display: block;
      width: 100%;
      text-align: center;
      transition: all 0.3s ease;
    }

    .btn-test {
      background: #ff6b6b;
      color: white;
    }

    .btn-test:hover {
      background: #ff5252;
      transform: scale(1.02);
    }

    .btn-test:active {
      background: #ff1744;
      transform: scale(0.98);
    }

    .btn-download {
      background: #4ecdc4;
      color: white;
    }

    .btn-download:hover {
      background: #26a69a;
      transform: scale(1.02);
    }

    .btn-download:active {
      background: #00796b;
      transform: scale(0.98);
    }

    .btn-fullscreen {
      background: #45b7d1;
      color: white;
    }

    .btn-fullscreen:hover {
      background: #2196f3;
      transform: scale(1.02);
    }

    .btn-fullscreen:active {
      background: #1976d2;
      transform: scale(0.98);
    }

    .status {
      margin: 20px 0;
      padding: 15px;
      border-radius: 8px;
      font-weight: bold;
      text-align: center;
      min-height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .status-info {
      background: #e3f2fd;
      color: #1976d2;
      border: 2px solid #bbdefb;
    }

    .status-success {
      background: #e8f5e8;
      color: #2e7d32;
      border: 2px solid #c8e6c9;
    }

    .status-error {
      background: #ffebee;
      color: #c62828;
      border: 2px solid #ffcdd2;
    }

    .log {
      background: #f5f5f5;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      margin: 10px 0;
      font-family: monospace;
      font-size: 14px;
      max-height: 200px;
      overflow-y: auto;
    }

    .clicked {
      background: #4caf50 !important;
      color: white !important;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üß™ Button Debug Test</h1>

    <div id="status" class="status status-info">
      –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –∫–Ω–æ–ø–æ–∫
    </div>

    <button id="testBtn1" class="btn btn-test">
      üß™ TEST 1: Simple Alert
    </button>

    <button id="testBtn2" class="btn btn-test">
      üß™ TEST 2: Change Status
    </button>

    <button id="testBtn3" class="btn btn-download">
      üíæ TEST 3: Download File
    </button>

    <button id="testBtn4" class="btn btn-fullscreen">
      üîç TEST 4: Open Window
    </button>

    <div class="log" id="log">
      <strong>–õ–æ–≥–∏:</strong><br>
      –û–∂–∏–¥–∞–Ω–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è...
    </div>
  </div>

  <script>
    let logCount = 0;

    function addLog(message) {
      logCount++;
      const log = document.getElementById('log');
      const time = new Date().toLocaleTimeString();
      log.innerHTML += '<br>' + logCount + '. [' + time + '] ' + message;
      log.scrollTop = log.scrollHeight;
      console.log(logCount + '. ' + message);
    }

    function updateStatus(message, type) {
      const status = document.getElementById('status');
      status.textContent = message;
      status.className = 'status status-' + type;
      addLog('Status: ' + message);
    }

    function markClicked(btnId) {
      const btn = document.getElementById(btnId);
      btn.classList.add('clicked');
      btn.textContent = '‚úÖ ' + btn.textContent.replace('üß™', '').replace('üíæ', '').replace('üîç', '').trim();
    }

    // TEST 1: –ü—Ä–æ—Å—Ç–æ–π alert
    function test1() {
      addLog('TEST 1: Simple Alert clicked');
      updateStatus('TEST 1: Alert —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞', 'success');
      markClicked('testBtn1');
      alert('üéâ TEST 1 –†–ê–ë–û–¢–ê–ï–¢! –ö–Ω–æ–ø–∫–∞ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –∫–ª–∏–∫–∏.');
    }

    // TEST 2: –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
    function test2() {
      addLog('TEST 2: Change Status clicked');
      updateStatus('TEST 2: –°—Ç–∞—Ç—É—Å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω!', 'success');
      markClicked('testBtn2');
    }

    // TEST 3: –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
    function test3() {
      addLog('TEST 3: Download File clicked');
      updateStatus('TEST 3: –ù–∞—á–∏–Ω–∞–µ–º —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ...', 'info');

      try {
        const content = '<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Debug Test</title></head><body><h1>üß™ Debug Test File</h1><p>–ï—Å–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª, –∑–Ω–∞—á–∏—Ç —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!</p><p>–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è: ' + new Date().toLocaleString() + '</p></body></html>';

        addLog('Creating blob...');
        const blob = new Blob([content], { type: 'text/html' });

        addLog('Creating download URL...');
        const url = URL.createObjectURL(blob);

        addLog('Creating download link...');
        const link = document.createElement('a');
        link.href = url;
        link.download = 'debug_test_' + Date.now() + '.html';

        addLog('Adding link to body...');
        document.body.appendChild(link);

        addLog('Clicking download link...');
        link.click();

        addLog('Removing link from body...');
        document.body.removeChild(link);

        addLog('Revoking URL...');
        URL.revokeObjectURL(url);

        updateStatus('TEST 3: –§–∞–π–ª –¥–æ–ª–∂–µ–Ω —Å–∫–∞—á–∞—Ç—å—Å—è!', 'success');
        markClicked('testBtn3');
        addLog('TEST 3: Download completed successfully');

      } catch (error) {
        addLog('TEST 3 ERROR: ' + error.message);
        updateStatus('TEST 3: –û—à–∏–±–∫–∞ - ' + error.message, 'error');
      }
    }

    // TEST 4: –û—Ç–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞
    function test4() {
      addLog('TEST 4: Open Window clicked');
      updateStatus('TEST 4: –û—Ç–∫—Ä—ã–≤–∞–µ–º –Ω–æ–≤–æ–µ –æ–∫–Ω–æ...', 'info');

      try {
        const content = '<html><head><title>Debug Window</title></head><body style="font-family:Arial;padding:20px;text-align:center;"><h1>üéâ –ù–æ–≤–æ–µ –æ–∫–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç!</h1><p>–ï—Å–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ —ç—Ç–æ –æ–∫–Ω–æ, –∑–Ω–∞—á–∏—Ç —Ñ—É–Ω–∫—Ü–∏—è openWindow —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.</p><button onclick="window.close()">–ó–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ</button></body></html>';

        addLog('Opening new window...');
        const newWindow = window.open('', '_blank', 'width=600,height=400');

        if (newWindow) {
          addLog('Writing content to new window...');
          newWindow.document.write(content);
          newWindow.document.close();
          newWindow.focus();

          updateStatus('TEST 4: –ù–æ–≤–æ–µ –æ–∫–Ω–æ –æ—Ç–∫—Ä—ã—Ç–æ!', 'success');
          markClicked('testBtn4');
          addLog('TEST 4: Window opened successfully');
        } else {
          addLog('TEST 4 ERROR: Popup blocked');
          updateStatus('TEST 4: Popup –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –±—Ä–∞—É–∑–µ—Ä–æ–º', 'error');
        }

      } catch (error) {
        addLog('TEST 4 ERROR: ' + error.message);
        updateStatus('TEST 4: –û—à–∏–±–∫–∞ - ' + error.message, 'error');
      }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', function() {
      addLog('DOM loaded, initializing...');

      // –ü—Ä–æ—Å—Ç–µ–π—à–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
      document.getElementById('testBtn1').addEventListener('click', test1);
      document.getElementById('testBtn2').addEventListener('click', test2);
      document.getElementById('testBtn3').addEventListener('click', test3);
      document.getElementById('testBtn4').addEventListener('click', test4);

      addLog('All event listeners attached');
      updateStatus('–í—Å–µ –≥–æ—Ç–æ–≤–æ! –ù–∞–∂–∏–º–∞–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É.', 'info');

      // Telegram WebApp –ø—Ä–æ–≤–µ—Ä–∫–∞
      if (window.Telegram && window.Telegram.WebApp) {
        addLog('Telegram WebApp detected');
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
      } else {
        addLog('Telegram WebApp not available - browser mode');
      }
    });
  </script>
</body>
</html>